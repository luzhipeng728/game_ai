(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[766],{1183:(e,s,a)=>{"use strict";a.d(s,{N:()=>x,d:()=>u});var t=a(5155),r=a(2115),n=a(9946);let l=(0,n.A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),i=(0,n.A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),c=(0,n.A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),d=(0,n.A)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),o=(0,n.A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function m(e){let{message:s,onClose:a}=e,{id:n,type:m,title:x,message:u,duration:p=5e3}=s;(0,r.useEffect)(()=>{let e=setTimeout(()=>{a(n)},p);return()=>clearTimeout(e)},[n,p,a]);let h={success:(0,t.jsx)(l,{className:"w-5 h-5 text-green-500"}),error:(0,t.jsx)(i,{className:"w-5 h-5 text-red-500"}),warning:(0,t.jsx)(c,{className:"w-5 h-5 text-yellow-500"}),info:(0,t.jsx)(d,{className:"w-5 h-5 text-blue-500"})};return(0,t.jsxs)("div",{className:"flex items-start p-4 border rounded-lg shadow-lg ".concat({success:"bg-green-50 border-green-200",error:"bg-red-50 border-red-200",warning:"bg-yellow-50 border-yellow-200",info:"bg-blue-50 border-blue-200"}[m]," animate-in slide-in-from-top duration-300"),children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:h[m]}),(0,t.jsxs)("div",{className:"ml-3 flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900",children:x}),u&&(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:u})]}),(0,t.jsx)("button",{onClick:()=>a(n),className:"ml-3 flex-shrink-0 text-gray-400 hover:text-gray-600",children:(0,t.jsx)(o,{className:"w-4 h-4"})})]})}function x(e){let{messages:s,onClose:a}=e;return(0,t.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-sm",children:s.map(e=>(0,t.jsx)(m,{message:e,onClose:a},e.id))})}function u(){let[e,s]=(0,r.useState)([]),a=e=>{let a=Math.random().toString(36).substring(2,9);s(s=>[...s,{...e,id:a}])};return{messages:e,removeToast:e=>{s(s=>s.filter(s=>s.id!==e))},toast:{success:(e,s)=>a({type:"success",title:e,message:s}),error:(e,s)=>a({type:"error",title:e,message:s}),warning:(e,s)=>a({type:"warning",title:e,message:s}),info:(e,s)=>a({type:"info",title:e,message:s})}}}},2091:(e,s,a)=>{"use strict";a.d(s,{A:()=>v});var t=a(5155),r=a(6874),n=a.n(r),l=a(5695),i=a(7340),c=a(3578),d=a(7580),o=a(1586),m=a(9376),x=a(7434),u=a(2713),p=a(381);let h=[{name:"仪表盘",href:"/",icon:i.A},{name:"场景管理",href:"/scenes",icon:c.A},{name:"NPC管理",href:"/npcs",icon:d.A},{name:"卡片管理",href:"/cards",icon:o.A},{name:"AI配置",href:"/ai-configs",icon:m.A},{name:"配置模板",href:"/templates",icon:x.A},{name:"数据分析",href:"/analytics",icon:u.A},{name:"系统设置",href:"/settings",icon:p.A}];function g(){let e=(0,l.usePathname)();return(0,t.jsxs)("div",{className:"w-64 bg-gray-900 text-white min-h-screen",children:[(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("h1",{className:"text-xl font-bold text-center",children:"苏丹的游戏"}),(0,t.jsx)("p",{className:"text-sm text-gray-400 text-center mt-2",children:"管理后台"})]}),(0,t.jsx)("nav",{className:"mt-6",children:h.map(s=>{let a=e===s.href,r=s.icon;return(0,t.jsxs)(n(),{href:s.href,className:"flex items-center px-6 py-3 text-left hover:bg-gray-800 transition-colors ".concat(a?"bg-gray-800 border-r-4 border-blue-500":""),children:[(0,t.jsx)(r,{className:"w-5 h-5 mr-3"}),s.name]},s.name)})})]})}var b=a(7924),y=a(3861),f=a(1007);function j(){return(0,t.jsx)("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"flex items-center space-x-4",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(b.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,t.jsx)("input",{type:"text",placeholder:"搜索...",className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)("button",{className:"p-2 text-gray-600 hover:text-gray-900 relative",children:[(0,t.jsx)(y.A,{className:"w-5 h-5"}),(0,t.jsx)("span",{className:"absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full w-2 h-2"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center",children:(0,t.jsx)(f.A,{className:"w-4 h-4 text-gray-600"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700",children:"管理员"})]})]})]})})}function v(e){let{children:s}=e;return(0,t.jsxs)("div",{className:"flex h-screen bg-gray-50",children:[(0,t.jsx)(g,{}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,t.jsx)(j,{}),(0,t.jsx)("main",{className:"flex-1 overflow-y-auto p-6",children:s})]})]})}},4616:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(9946).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},5731:(e,s,a)=>{"use strict";a.d(s,{BB:()=>l,ER:()=>n,Fw:()=>r,Pb:()=>i,hM:()=>c});let t=a(3464).A.create({baseURL:"",headers:{"Content-Type":"application/json"},timeout:1e4}),r={getScenes:()=>t.get("/api/scenes/"),getScene:e=>t.get("/api/scenes/".concat(e)),createScene:e=>t.post("/api/scenes/",e),updateScene:(e,s)=>t.put("/api/scenes/".concat(e),s),deleteScene:e=>t.delete("/api/scenes/".concat(e)),getSceneConfig:e=>t.get("/api/scenes/".concat(e,"/config")),getSceneNPCs:e=>t.get("/api/scenes/".concat(e,"/npcs")),addSceneNPC:(e,s)=>t.post("/api/scenes/".concat(e,"/npcs"),s),removeSceneNPC:(e,s)=>t.delete("/api/scenes/".concat(e,"/npcs/").concat(s)),getSceneRewards:e=>t.get("/api/scenes/".concat(e,"/rewards")),saveSceneRewards:(e,s)=>t.post("/api/scenes/".concat(e,"/rewards"),s),getSceneExtendedRewards:e=>t.get("/api/scenes/".concat(e,"/extended-rewards")),saveSceneExtendedRewards:(e,s)=>t.post("/api/scenes/".concat(e,"/extended-rewards"),s),getSceneRequirements:e=>t.get("/api/scenes/".concat(e,"/requirements")),saveSceneRequirements:(e,s)=>t.post("/api/scenes/".concat(e,"/requirements"),s),getSceneCardBindings:e=>t.get("/api/scenes/".concat(e,"/card-bindings")),addSceneCardBinding:(e,s)=>t.post("/api/scenes/".concat(e,"/card-bindings"),s),removeSceneCardBinding:(e,s)=>t.delete("/api/scenes/".concat(e,"/card-bindings/").concat(s)),getAvailableCards:()=>t.get("/api/cards/"),getAvailablePlayerNPCs:()=>t.get("/api/npcs/"),testScene:e=>t.post("/api/scenes/".concat(e,"/test"))},n={getNPCs:()=>t.get("/api/npcs/"),getNPC:e=>t.get("/api/npcs/".concat(e)),createNPC:e=>t.post("/api/npcs/",e),updateNPC:(e,s)=>t.put("/api/npcs/".concat(e),s),deleteNPC:e=>t.delete("/api/npcs/".concat(e))},l={getAIConfigs:()=>t.get("/api/ai-configs/"),getAIConfig:e=>t.get("/api/ai-configs/".concat(e)),createAIConfig:e=>t.post("/api/ai-configs/",e),updateAIConfig:(e,s)=>t.put("/api/ai-configs/".concat(e),s),deleteAIConfig:e=>t.delete("/api/ai-configs/".concat(e)),getAIPerformance:e=>t.get("/api/ai-configs/".concat(e,"/performance")),testAIConfig:(e,s)=>t.post("/api/ai-configs/".concat(e,"/test"),s),optimizeAIConfig:e=>t.post("/api/ai-configs/".concat(e,"/optimize")),getAITypes:()=>t.get("/api/ai-configs/types/enum")},i={getCards:()=>t.get("/api/cards/"),getCard:e=>t.get("/api/cards/".concat(e)),createCard:e=>t.post("/api/cards/",e),updateCard:(e,s)=>t.put("/api/cards/".concat(e),s),deleteCard:e=>t.delete("/api/cards/".concat(e))},c={getTemplates:e=>t.get("/api/templates/",{params:e}),getTemplate:e=>t.get("/api/templates/".concat(e)),createTemplate:e=>t.post("/api/templates/",e),updateTemplate:(e,s)=>t.put("/api/templates/".concat(e),s),deleteTemplate:e=>t.delete("/api/templates/".concat(e)),createFromScene:e=>t.post("/api/templates/from-scene",e),createFromAIConfig:(e,s,a)=>t.post("/api/templates/from-ai-config/".concat(e),null,{params:{template_name:s,description:a}}),applyToScene:(e,s)=>t.post("/api/templates/".concat(e,"/apply-to-scene/").concat(s)),getCategories:()=>t.get("/api/templates/categories/enum"),getTypes:()=>t.get("/api/templates/types/enum")}},6333:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>y});var t=a(5155),r=a(2115),n=a(2091),l=a(1183),i=a(4616),c=a(9946);let d=(0,c.A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),o=(0,c.A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var m=a(3717),x=a(7434),u=a(1586),p=a(381);let h=(0,c.A)("award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);var g=a(2525),b=a(5731);function y(){let[e,s]=(0,r.useState)([]),[a,c]=(0,r.useState)(!0),[y,f]=(0,r.useState)(!1),[j,v]=(0,r.useState)(null),[N,w]=(0,r.useState)(new Set),[_,C]=(0,r.useState)({}),{messages:k,removeToast:S,toast:P}=(0,l.d)(),[A,F]=(0,r.useState)({scene_id:"",name:"",category:"main_story",description:"",narrator_prompt:"",chapter:1,location:"",time_of_day:"morning",weather:"clear"}),[I,q]=(0,r.useState)(!1),[R,B]=(0,r.useState)(null),[E,T]=(0,r.useState)([]),[z,M]=(0,r.useState)([]),[D,O]=(0,r.useState)(!1),[L,H]=(0,r.useState)(null),[U,G]=(0,r.useState)({success_attribute_points:0,success_experience:0,success_reputation:0,success_gold:0,failure_reputation:0}),[J,K]=(0,r.useState)(!1),[Q,V]=(0,r.useState)({success_attribute_points:0,success_experience:0,success_reputation:0,success_gold:0,failure_reputation:0,failure_gold:0,failure_attribute_penalty:0,reward_cards:[],card_reward_probability:{},reward_npcs:[],npc_reward_conditions:{},special_rewards:{},unlock_content:[],perfect_completion_bonus:{},time_bonus:{},efficiency_bonus:{},dynamic_reward_formula:"",performance_multiplier:1}),[W,X]=(0,r.useState)(!1),[Y,Z]=(0,r.useState)(null),[$,ee]=(0,r.useState)({strength:0,defense:0,intelligence:0,charisma:0,loyalty:0,influence:0,command:0,stealth:0,health:0}),[es,ea]=(0,r.useState)(!1),[et,er]=(0,r.useState)(null),[en,el]=(0,r.useState)([]),[ei,ec]=(0,r.useState)([]),[ed,eo]=(0,r.useState)([]),[em,ex]=(0,r.useState)({card_id:"",binding_type:"optional",max_uses_per_scene:1,cooldown_rounds:0,scene_effect_modifier:1,special_effects:{},unlock_conditions:{},visibility_conditions:{},usage_reward_bonus:{}});(0,r.useEffect)(()=>{eu()},[]);let eu=async()=>{try{let e=await b.Fw.getScenes();s(e.data)}catch(e){console.error("获取场景列表失败:",e),P.error("获取场景列表失败","请检查API服务是否正常运行")}finally{c(!1)}},ep=async e=>{e.preventDefault();try{j?(await b.Fw.updateScene(j.id,A),P.success("场景更新成功")):(await b.Fw.createScene(A),P.success("场景创建成功")),f(!1),v(null),eg(),eu()}catch(e){console.error("操作失败:",e),P.error("操作失败","请检查输入数据")}},eh=async e=>{if(confirm('确定要删除场景 "'.concat(e.name,'" 吗？')))try{await b.Fw.deleteScene(e.id),P.success("场景删除成功"),eu()}catch(e){console.error("删除失败:",e),P.error("删除失败","请稍后重试")}},eg=()=>{F({scene_id:"",name:"",category:"main_story",description:"",narrator_prompt:"",chapter:1,location:"",time_of_day:"morning",weather:"clear"})},eb=async e=>{let s=new Set(N);if(N.has(e))s.delete(e);else if(s.add(e),!_[e])try{let[s,a,t,r,n,l,i]=await Promise.all([b.Fw.getSceneNPCs(e),b.Fw.getSceneRewards(e),b.Fw.getSceneExtendedRewards(e),b.Fw.getSceneRequirements(e),b.Fw.getSceneCardBindings(e),b.Fw.getAvailablePlayerNPCs(),b.Fw.getAvailableCards()]);C(c=>({...c,[e]:{npcs:s.data,rewards:a.data,extendedRewards:t.data,requirements:r.data,cardBindings:n.data,availableNPCs:l.data,availableCards:i.data}}))}catch(e){console.error("加载场景详情失败:",e),P.error("加载场景详情失败","请稍后重试")}w(s)},ey=async e=>{B(e);try{let[s,a]=await Promise.all([b.Fw.getSceneNPCs(e.id),b.ER.getNPCs()]);T(s.data),M(a.data),q(!0)}catch(e){console.error("获取NPC配置失败:",e),P.error("获取NPC配置失败","请稍后重试")}},ef=async e=>{H(e);try{let[s,a,t,r]=await Promise.all([b.Fw.getSceneRewards(e.id),b.Fw.getSceneExtendedRewards(e.id),b.Fw.getAvailableCards(),b.Fw.getAvailablePlayerNPCs()]);G(s.data),V(a.data),ec(t.data),eo(r.data),O(!0)}catch(e){console.error("获取奖励配置失败:",e),G({success_attribute_points:0,success_experience:0,success_reputation:0,success_gold:0,failure_reputation:0}),V({success_attribute_points:0,success_experience:0,success_reputation:0,success_gold:0,failure_reputation:0,failure_gold:0,failure_attribute_penalty:0,reward_cards:[],reward_npcs:[],special_rewards:{},unlock_content:[],perfect_completion_bonus:{},performance_multiplier:1});try{let[e,s]=await Promise.all([b.Fw.getAvailableCards(),b.Fw.getAvailablePlayerNPCs()]);ec(e.data),eo(s.data)}catch(e){console.error("获取可用卡片和NPC数据失败:",e),ec([]),eo([])}O(!0)}},ej=async()=>{if(L)try{await Promise.all([b.Fw.saveSceneRewards(L.id,U),b.Fw.saveSceneExtendedRewards(L.id,Q)]),P.success("奖励配置保存成功"),O(!1),eu()}catch(e){console.error("保存奖励配置失败:",e),P.error("保存奖励配置失败","请稍后重试")}},ev=(e,s,a)=>{let t=[...Q.reward_npcs||[]];t[e]={...t[e],[s]:a},V({...Q,reward_npcs:t})},eN=(e,s,a)=>{let t=[...Q.reward_cards||[]];t[e]={...t[e],[s]:a},V({...Q,reward_cards:t})},ew=async e=>{Z(e);try{let s=await b.Fw.getSceneRequirements(e.id);ee(s.data),X(!0)}catch(e){console.error("获取场景要求配置失败:",e),ee({strength:0,defense:0,intelligence:0,charisma:0,loyalty:0,influence:0,command:0,stealth:0,health:0}),X(!0)}},e_=async()=>{if(!Y)return void P.error("未选择场景");try{await b.Fw.saveSceneRequirements(Y.id,$),P.success("场景属性要求保存成功"),X(!1)}catch(e){console.error("保存场景属性要求失败:",e),P.error("保存失败")}},eC=async e=>{er(e);try{let[s,a]=await Promise.all([b.Fw.getSceneCardBindings(e.id),b.Fw.getAvailableCards()]);el(s.data),ec(a.data),ea(!0)}catch(e){console.error("获取卡片绑定配置失败:",e),el([]);try{let e=await b.Fw.getAvailableCards();ec(e.data)}catch(e){console.error("获取可用卡片数据失败:",e),ec([])}ea(!0)}},ek=async()=>{if(!et||!em.card_id)return void P.error("请选择要绑定的卡片");try{await b.Fw.addSceneCardBinding(et.id,em),P.success("卡片绑定添加成功"),ex({card_id:"",binding_type:"optional",max_uses_per_scene:1,cooldown_rounds:0,scene_effect_modifier:1,special_effects:{},unlock_conditions:{},visibility_conditions:{},usage_reward_bonus:{}});let e=await b.Fw.getSceneCardBindings(et.id);el(e.data)}catch(e){console.error("添加卡片绑定失败:",e),P.error("添加卡片绑定失败","请稍后重试")}},eS=async e=>{if(et&&confirm("确定要删除这个卡片绑定吗？"))try{await b.Fw.removeSceneCardBinding(et.id,e),P.success("卡片绑定删除成功");let s=await b.Fw.getSceneCardBindings(et.id);el(s.data)}catch(e){console.error("删除卡片绑定失败:",e),P.error("删除卡片绑定失败","请稍后重试")}},eP=async e=>{if(R)try{let s={npc_id:e.id,role:"supporter",behavior:"neutral",can_be_challenged:!0};await b.Fw.addSceneNPC(R.id,s),P.success("NPC添加成功");let a=await b.Fw.getSceneNPCs(R.id);T(a.data)}catch(e){console.error("添加NPC失败:",e),P.error("添加NPC失败","请稍后重试")}},eA=async e=>{if(R&&confirm("确定要从场景中移除这个NPC吗？"))try{await b.Fw.removeSceneNPC(R.id,e),P.success("NPC移除成功");let s=await b.Fw.getSceneNPCs(R.id);T(s.data)}catch(e){console.error("移除NPC失败:",e),P.error("移除NPC失败","请稍后重试")}};return a?(0,t.jsx)(n.A,{children:(0,t.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,t.jsx)("div",{className:"text-lg text-gray-600",children:"加载中..."})})}):(0,t.jsxs)(n.A,{children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"场景管理"}),(0,t.jsx)("p",{className:"text-gray-600",children:"管理游戏场景和相关配置"})]}),(0,t.jsxs)("button",{onClick:()=>{v(null),eg(),f(!0)},className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center space-x-2",children:[(0,t.jsx)(i.A,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:"新建场景"})]})]}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"场景信息"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"类型"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"状态"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"NPC数量"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),(0,t.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>{var s,a,n,l,i,c,b,y,j,w,C,k,S,P;return(0,t.jsxs)(r.Fragment,{children:[(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("button",{onClick:()=>eb(e.id),className:"mr-2 p-1 text-gray-400 hover:text-gray-600",children:N.has(e.id)?(0,t.jsx)(d,{className:"w-4 h-4"}):(0,t.jsx)(o,{className:"w-4 h-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",e.scene_id]}),e.description&&(0,t.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:e.description})]})]})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsx)("span",{className:"text-sm text-gray-900",children:{main_story:"主线剧情",side_quest:"支线任务",faction:"阵营",random:"随机"}[P=e.category]||P})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat((e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"draft":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}})(e.status)),children:e.status})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.npc_count}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,t.jsxs)("div",{className:"flex space-x-2 flex-wrap",children:[(0,t.jsx)("button",{onClick:()=>{v(e),F({scene_id:e.scene_id,name:e.name,category:e.category,description:e.description||"",narrator_prompt:"",chapter:1,location:"",time_of_day:"morning",weather:"clear"}),f(!0)},className:"text-blue-600 hover:text-blue-900",title:"编辑基础信息",children:(0,t.jsx)(m.A,{className:"w-4 h-4"})}),(0,t.jsx)("button",{onClick:()=>ew(e),className:"text-purple-600 hover:text-purple-900",title:"进入要求配置",children:(0,t.jsx)(x.A,{className:"w-4 h-4"})}),(0,t.jsx)("button",{onClick:()=>eC(e),className:"text-indigo-600 hover:text-indigo-900",title:"卡片绑定配置",children:(0,t.jsx)(u.A,{className:"w-4 h-4"})}),(0,t.jsx)("button",{onClick:()=>ey(e),className:"text-green-600 hover:text-green-900",title:"NPC配置",children:(0,t.jsx)(p.A,{className:"w-4 h-4"})}),(0,t.jsx)("button",{onClick:()=>ef(e),className:"text-yellow-600 hover:text-yellow-900",title:"奖励配置",children:(0,t.jsx)(h,{className:"w-4 h-4"})}),(0,t.jsx)("button",{onClick:()=>eh(e),className:"text-red-600 hover:text-red-900",title:"删除",children:(0,t.jsx)(g.A,{className:"w-4 h-4"})})]})})]}),N.has(e.id)&&_[e.id]&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"px-6 py-4 bg-gray-50",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"font-medium text-gray-900 mb-2",children:["绑定NPC (",(null==(s=_[e.id].npcs)?void 0:s.length)||0,")"]}),(0,t.jsx)("div",{className:"bg-white rounded border p-3",children:(null==(a=_[e.id].npcs)?void 0:a.length)>0?(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:_[e.id].npcs.map((e,s)=>(0,t.jsxs)("div",{className:"text-sm border rounded p-2",children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),(0,t.jsxs)("div",{className:"text-gray-600",children:["角色: ",e.role]}),(0,t.jsxs)("div",{className:"text-gray-600",children:["行为: ",e.behavior]})]},s))}):(0,t.jsx)("div",{className:"text-gray-500 text-sm",children:"未配置NPC"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"进入属性要求"}),(0,t.jsx)("div",{className:"bg-white rounded border p-3",children:_[e.id].requirements&&Object.keys(_[e.id].requirements).length>0?(0,t.jsx)("div",{className:"grid grid-cols-3 gap-2 text-sm",children:Object.entries(_[e.id].requirements).map(e=>{let[s,a]=e;return a>0&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("span",{className:"text-gray-600",children:[s,":"]}),(0,t.jsxs)("span",{className:"font-medium",children:["≥",a]})]},s)})}):(0,t.jsx)("div",{className:"text-gray-500 text-sm",children:"未配置属性要求"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"font-medium text-gray-900 mb-2",children:["卡片绑定 (",(null==(n=_[e.id].cardBindings)?void 0:n.length)||0,")"]}),(0,t.jsx)("div",{className:"bg-white rounded border p-3",children:(null==(l=_[e.id].cardBindings)?void 0:l.length)>0?(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:_[e.id].cardBindings.map((e,s)=>(0,t.jsxs)("div",{className:"text-sm border rounded p-2",children:[(0,t.jsx)("div",{className:"font-medium",children:e.card_name}),(0,t.jsxs)("div",{className:"text-gray-600",children:["类型: ",e.binding_type]}),(0,t.jsxs)("div",{className:"text-gray-600",children:["倍数: ",e.scene_effect_modifier,"x"]})]},s))}):(0,t.jsx)("div",{className:"text-gray-500 text-sm",children:"未配置卡片绑定"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"基础奖励"}),(0,t.jsx)("div",{className:"bg-white rounded border p-3",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:["属性点: ",(null==(i=_[e.id].rewards)?void 0:i.success_attribute_points)||0]}),(0,t.jsxs)("div",{children:["经验: ",(null==(c=_[e.id].rewards)?void 0:c.success_experience)||0]}),(0,t.jsxs)("div",{children:["声望: ",(null==(b=_[e.id].rewards)?void 0:b.success_reputation)||0]}),(0,t.jsxs)("div",{children:["金币: ",(null==(y=_[e.id].rewards)?void 0:y.success_gold)||0]})]})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"扩展奖励"}),(0,t.jsx)("div",{className:"bg-white rounded border p-3",children:(0,t.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-gray-700 mb-1",children:"卡片奖励"}),(null==(w=_[e.id].extendedRewards)||null==(j=w.reward_cards)?void 0:j.length)>0?(0,t.jsx)("div",{className:"space-y-1",children:_[e.id].extendedRewards.reward_cards.map((s,a)=>{var r;let n=null==(r=_[e.id].availableCards)?void 0:r.find(e=>e.id===s.card_id);return(0,t.jsxs)("div",{className:"text-gray-600 flex justify-between",children:[(0,t.jsx)("span",{children:(null==n?void 0:n.name)||"未知卡片"}),(0,t.jsxs)("span",{children:["x",s.quantity," (",(100*s.probability).toFixed(0),"%)"]})]},a)})}):(0,t.jsx)("div",{className:"text-gray-500",children:"无卡片奖励"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-gray-700 mb-1",children:"NPC奖励"}),(null==(k=_[e.id].extendedRewards)||null==(C=k.reward_npcs)?void 0:C.length)>0?(0,t.jsx)("div",{className:"space-y-1",children:_[e.id].extendedRewards.reward_npcs.map((s,a)=>{var r;let n=null==(r=_[e.id].availableNPCs)?void 0:r.filter(e=>"player_npc"===e.npc_type).find(e=>e.id===s.npc_id);return(0,t.jsxs)("div",{className:"text-gray-600 flex justify-between",children:[(0,t.jsx)("span",{children:(null==n?void 0:n.name)||"未知NPC"}),(0,t.jsxs)("span",{children:["x",s.quantity," (",(100*s.probability).toFixed(0),"%)"]})]},a)})}):(0,t.jsx)("div",{className:"text-gray-500",children:"无NPC奖励"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-gray-700",children:"表现倍数"}),(0,t.jsxs)("div",{className:"text-gray-600",children:[(null==(S=_[e.id].extendedRewards)?void 0:S.performance_multiplier)||1,"x"]})]})]})})]})]})})})]},e.id)})})]})}),y&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:j?"编辑场景":"新建场景"}),(0,t.jsxs)("form",{onSubmit:ep,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"场景ID"}),(0,t.jsx)("input",{type:"text",value:A.scene_id,onChange:e=>F({...A,scene_id:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,disabled:!!j})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"场景名称"}),(0,t.jsx)("input",{type:"text",value:A.name,onChange:e=>F({...A,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"场景类型"}),(0,t.jsxs)("select",{value:A.category,onChange:e=>F({...A,category:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,t.jsx)("option",{value:"main_story",children:"主线剧情"}),(0,t.jsx)("option",{value:"side_quest",children:"支线任务"}),(0,t.jsx)("option",{value:"faction",children:"阵营"}),(0,t.jsx)("option",{value:"random",children:"随机"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"描述"}),(0,t.jsx)("textarea",{value:A.description,onChange:e=>F({...A,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"旁白提示词"}),(0,t.jsx)("textarea",{value:A.narrator_prompt,onChange:e=>F({...A,narrator_prompt:e.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入旁白AI的提示词...",required:!0})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,t.jsx)("button",{type:"button",onClick:()=>f(!1),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",children:"取消"}),(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:j?"更新":"创建"})]})]})]})}),I&&R&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["场景NPC配置 - ",R.name]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"当前NPC配置"}),(0,t.jsx)("div",{className:"bg-gray-50 rounded p-4",children:E.length>0?(0,t.jsx)("div",{className:"space-y-2",children:E.map((e,s)=>(0,t.jsxs)("div",{className:"flex justify-between items-center bg-white p-3 rounded border",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:e.name}),(0,t.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["角色: ",e.role]}),(0,t.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["行为: ",e.behavior]}),(0,t.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["优先级: ",e.speaking_priority]})]}),(0,t.jsx)("button",{className:"text-red-600 hover:text-red-800 text-sm",onClick:()=>eA(e.npc_id),children:"移除"})]},s))}):(0,t.jsx)("p",{className:"text-gray-500",children:"还没有配置NPC"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"可用NPC列表"}),(0,t.jsx)("div",{className:"bg-gray-50 rounded p-4 max-h-60 overflow-y-auto",children:z.length>0?(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:z.filter(e=>"player_npc"!==e.npc_type).map(e=>(0,t.jsxs)("div",{className:"bg-white p-3 rounded border flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:e.name}),(0,t.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["(",e.faction," - ",e.npc_type,")"]})]}),(0,t.jsx)("button",{className:"text-blue-600 hover:text-blue-800 text-sm",onClick:()=>eP(e),children:"添加"})]},e.id))}):(0,t.jsx)("p",{className:"text-gray-500",children:"没有可用的NPC"})})]})]}),(0,t.jsx)("div",{className:"flex justify-end space-x-3 mt-6",children:(0,t.jsx)("button",{onClick:()=>q(!1),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",children:"关闭"})})]})}),D&&L&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-6xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["奖励配置 - ",L.name]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,t.jsx)("h4",{className:"font-medium mb-3 text-green-700",children:"基础奖励"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"font-medium mb-2",children:"成功奖励"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"属性点"}),(0,t.jsx)("input",{type:"number",value:U.success_attribute_points,onChange:e=>G({...U,success_attribute_points:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"经验值"}),(0,t.jsx)("input",{type:"number",value:U.success_experience,onChange:e=>G({...U,success_experience:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"声望值"}),(0,t.jsx)("input",{type:"number",value:U.success_reputation,onChange:e=>G({...U,success_reputation:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"金币"}),(0,t.jsx)("input",{type:"number",value:U.success_gold,onChange:e=>G({...U,success_gold:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"font-medium mb-2",children:"失败惩罚"}),(0,t.jsxs)("div",{className:"w-full md:w-1/4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"声望值损失"}),(0,t.jsx)("input",{type:"number",value:U.failure_reputation,onChange:e=>G({...U,failure_reputation:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,t.jsx)("h4",{className:"font-medium mb-3 text-blue-700",children:"扩展奖励"}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"font-medium mb-2",children:"扩展成功奖励"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"属性点"}),(0,t.jsx)("input",{type:"number",value:Q.success_attribute_points,onChange:e=>V({...Q,success_attribute_points:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",min:"0"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"经验值"}),(0,t.jsx)("input",{type:"number",value:Q.success_experience,onChange:e=>V({...Q,success_experience:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",min:"0"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"声望值"}),(0,t.jsx)("input",{type:"number",value:Q.success_reputation,onChange:e=>V({...Q,success_reputation:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"金币"}),(0,t.jsx)("input",{type:"number",value:Q.success_gold,onChange:e=>V({...Q,success_gold:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",min:"0"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"font-medium mb-2",children:"扩展失败惩罚"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"声望损失"}),(0,t.jsx)("input",{type:"number",value:Q.failure_reputation,onChange:e=>V({...Q,failure_reputation:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"金币损失"}),(0,t.jsx)("input",{type:"number",value:Q.failure_gold,onChange:e=>V({...Q,failure_gold:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"属性惩罚"}),(0,t.jsx)("input",{type:"number",value:Q.failure_attribute_penalty,onChange:e=>V({...Q,failure_attribute_penalty:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)("h5",{className:"font-medium",children:"NPC奖励"}),(0,t.jsx)("button",{onClick:()=>{V({...Q,reward_npcs:[...Q.reward_npcs||[],{npc_id:"",quantity:1,probability:1}]})},className:"bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm",children:"+ 添加NPC"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(Q.reward_npcs||[]).map((e,s)=>(0,t.jsxs)("div",{className:"flex gap-2 items-center bg-gray-50 p-3 rounded",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"选择NPC"}),(0,t.jsxs)("select",{value:e.npc_id||"",onChange:e=>ev(s,"npc_id",e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",children:[(0,t.jsx)("option",{value:"",children:"请选择NPC"}),ed.filter(e=>"player_npc"===e.npc_type).map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.faction," - ",e.tier,")"]},e.id))]})]}),(0,t.jsxs)("div",{className:"w-20",children:[(0,t.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"数量"}),(0,t.jsx)("input",{type:"number",value:e.quantity||1,onChange:e=>ev(s,"quantity",parseInt(e.target.value)||1),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",min:"1"})]}),(0,t.jsxs)("div",{className:"w-24",children:[(0,t.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"概率"}),(0,t.jsx)("input",{type:"number",step:"0.1",value:e.probability||1,onChange:e=>ev(s,"probability",parseFloat(e.target.value)||1),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",min:"0",max:"1"})]}),(0,t.jsx)("button",{onClick:()=>(e=>{let s=(Q.reward_npcs||[]).filter((s,a)=>a!==e);V({...Q,reward_npcs:s})})(s),className:"text-red-600 hover:text-red-800 px-2 py-1",children:"删除"})]},s)),(!Q.reward_npcs||0===Q.reward_npcs.length)&&(0,t.jsx)("div",{className:"text-gray-500 text-sm py-2",children:"暂无NPC奖励，点击上方按钮添加"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)("h5",{className:"font-medium",children:"卡片奖励"}),(0,t.jsx)("button",{onClick:()=>{V({...Q,reward_cards:[...Q.reward_cards||[],{card_id:"",quantity:1,probability:1}]})},className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm",children:"+ 添加卡片"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(Q.reward_cards||[]).map((e,s)=>(0,t.jsxs)("div",{className:"flex gap-2 items-center bg-gray-50 p-3 rounded",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"选择卡片"}),(0,t.jsxs)("select",{value:e.card_id||"",onChange:e=>eN(s,"card_id",e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",children:[(0,t.jsx)("option",{value:"",children:"请选择卡片"}),ei.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.rarity,")"]},e.id))]})]}),(0,t.jsxs)("div",{className:"w-20",children:[(0,t.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"数量"}),(0,t.jsx)("input",{type:"number",value:e.quantity||1,onChange:e=>eN(s,"quantity",parseInt(e.target.value)||1),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",min:"1"})]}),(0,t.jsxs)("div",{className:"w-24",children:[(0,t.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"概率"}),(0,t.jsx)("input",{type:"number",step:"0.1",value:e.probability||1,onChange:e=>eN(s,"probability",parseFloat(e.target.value)||1),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",min:"0",max:"1"})]}),(0,t.jsx)("button",{onClick:()=>(e=>{let s=(Q.reward_cards||[]).filter((s,a)=>a!==e);V({...Q,reward_cards:s})})(s),className:"text-red-600 hover:text-red-800 px-2 py-1",children:"删除"})]},s)),(!Q.reward_cards||0===Q.reward_cards.length)&&(0,t.jsx)("div",{className:"text-gray-500 text-sm py-2",children:"暂无卡片奖励，点击上方按钮添加"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"font-medium mb-2",children:"表现倍数"}),(0,t.jsxs)("div",{className:"w-full md:w-1/4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"倍数 (1.0 = 100%)"}),(0,t.jsx)("input",{type:"number",step:"0.1",value:Q.performance_multiplier,onChange:e=>V({...Q,performance_multiplier:parseFloat(e.target.value)||1}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",min:"0"})]})]})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,t.jsx)("button",{onClick:()=>O(!1),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",children:"取消"}),(0,t.jsx)("button",{onClick:ej,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"保存奖励配置"})]})]})}),W&&Y&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["进入属性要求配置 - ",Y.name]}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"bg-gray-50 rounded p-4",children:[(0,t.jsx)("h4",{className:"font-medium mb-4",children:"设置进入场景所需的最低属性值"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"力量 (Strength)"}),(0,t.jsx)("input",{type:"number",value:$.strength,onChange:e=>ee({...$,strength:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",max:"100"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"防御 (Defense)"}),(0,t.jsx)("input",{type:"number",value:$.defense,onChange:e=>ee({...$,defense:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",max:"100"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"智力 (Intelligence)"}),(0,t.jsx)("input",{type:"number",value:$.intelligence,onChange:e=>ee({...$,intelligence:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",max:"100"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"魅力 (Charisma)"}),(0,t.jsx)("input",{type:"number",value:$.charisma,onChange:e=>ee({...$,charisma:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",max:"100"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"忠诚 (Loyalty)"}),(0,t.jsx)("input",{type:"number",value:$.loyalty,onChange:e=>ee({...$,loyalty:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",max:"100"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"影响力 (Influence)"}),(0,t.jsx)("input",{type:"number",value:$.influence,onChange:e=>ee({...$,influence:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",max:"100"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"指挥力 (Command)"}),(0,t.jsx)("input",{type:"number",value:$.command,onChange:e=>ee({...$,command:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",max:"100"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"隐秘 (Stealth)"}),(0,t.jsx)("input",{type:"number",value:$.stealth,onChange:e=>ee({...$,stealth:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",max:"100"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"生命值 (Health)"}),(0,t.jsx)("input",{type:"number",value:$.health,onChange:e=>ee({...$,health:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",max:"500"})]})]}),(0,t.jsx)("div",{className:"mt-4 p-3 bg-blue-50 rounded-md",children:(0,t.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,t.jsx)("strong",{children:"说明："})," 只有属性值设置为0的要求不会被应用。设置为大于0的值将作为进入场景的最低要求。"]})})]})}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,t.jsx)("button",{onClick:()=>X(!1),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",children:"关闭"}),(0,t.jsx)("button",{onClick:e_,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"保存配置"})]})]})}),es&&et&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["卡片绑定配置 - ",et.name]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"当前卡片绑定"}),(0,t.jsx)("div",{className:"bg-gray-50 rounded p-4 max-h-60 overflow-y-auto",children:en.length>0?(0,t.jsx)("div",{className:"space-y-2",children:en.map((e,s)=>(0,t.jsxs)("div",{className:"bg-white p-3 rounded border flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:e.card_name}),(0,t.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["类型: ",e.binding_type," | 倍数: ",e.scene_effect_modifier,"x"]}),(0,t.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:["最大使用: ",e.max_uses_per_scene,"次 | 冷却: ",e.cooldown_rounds,"轮"]})]}),(0,t.jsx)("button",{className:"text-red-600 hover:text-red-800 text-sm",onClick:()=>eS(e.id),children:"删除"})]},s))}):(0,t.jsx)("p",{className:"text-gray-500",children:"还没有配置卡片绑定"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"添加新卡片绑定"}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded p-4 space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"选择卡片"}),(0,t.jsxs)("select",{value:em.card_id,onChange:e=>ex({...em,card_id:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[(0,t.jsx)("option",{value:"",children:"请选择卡片"}),ei.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.rarity,")"]},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"绑定类型"}),(0,t.jsxs)("select",{value:em.binding_type,onChange:e=>ex({...em,binding_type:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[(0,t.jsx)("option",{value:"required",children:"必需 (required)"}),(0,t.jsx)("option",{value:"optional",children:"可选 (optional)"}),(0,t.jsx)("option",{value:"bonus",children:"加成 (bonus)"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"最大使用次数"}),(0,t.jsx)("input",{type:"number",value:em.max_uses_per_scene,onChange:e=>ex({...em,max_uses_per_scene:parseInt(e.target.value)||1}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",min:"1"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"冷却轮数"}),(0,t.jsx)("input",{type:"number",value:em.cooldown_rounds,onChange:e=>ex({...em,cooldown_rounds:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",min:"0"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"效果倍数"}),(0,t.jsx)("input",{type:"number",step:"0.1",value:em.scene_effect_modifier,onChange:e=>ex({...em,scene_effect_modifier:parseFloat(e.target.value)||1}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",min:"0"})]})]}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("button",{onClick:ek,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md",children:"添加绑定"})})]})]}),(0,t.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,t.jsx)("h5",{className:"font-medium text-blue-900 mb-2",children:"功能说明"}),(0,t.jsxs)("div",{className:"text-sm text-blue-800 space-y-1",children:[(0,t.jsx)("p",{children:"• required（必需）：玩家必须拥有此卡片才能进入场景"}),(0,t.jsx)("p",{children:"• optional（可选）：玩家可以选择使用此卡片获得额外效果"}),(0,t.jsx)("p",{children:"• bonus（加成）：使用此卡片在场景中获得效果倍数加成"}),(0,t.jsx)("p",{children:"• 效果倍数：卡片在此场景中的效果增强倍数（1.0 = 100%）"})]})]})]}),(0,t.jsx)("div",{className:"flex justify-end space-x-3 mt-6",children:(0,t.jsx)("button",{onClick:()=>ea(!1),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",children:"关闭"})})]})})]}),(0,t.jsx)(l.N,{messages:k,onClose:S})]})}},8668:(e,s,a)=>{Promise.resolve().then(a.bind(a,6333))}},e=>{e.O(0,[291,488,441,964,358],()=>e(e.s=8668)),_N_E=e.O()}]);